<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>犹豫行为与认知评估平台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .animate-float { animation: float 6s ease-in-out infinite; }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-20px); } 100% { transform: translateY(0px); } }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.5); }
        
        /* 弹窗动画 */
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: opacity 300ms ease-out, transform 300ms ease-out; }
        .modal-exit { opacity: 1; transform: scale(1); }
        .modal-exit-active { opacity: 0; transform: scale(0.95); transition: opacity 200ms ease-in, transform 200ms ease-in; }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-indigo-50 text-slate-800 font-sans h-screen overflow-hidden relative">

    <!-- 背景装饰 -->
    <div class="absolute top-[-10%] left-[-10%] w-96 h-96 bg-blue-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-float"></div>
    <div class="absolute bottom-[-10%] right-[-10%] w-96 h-96 bg-purple-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-float" style="animation-delay: 2s"></div>

    <div class="relative z-10 flex flex-col items-center justify-center h-full px-4">
        
        <div class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-extrabold text-slate-900 mb-4 tracking-tight">
                Hesitation Behavior <br>
                <span class="text-blue-600">Research Lab</span>
            </h1>
            <p class="text-lg text-slate-600 max-w-xl mx-auto">
                Process Data Collection & Cognitive State Analysis
            </p>
        </div>

        <div class="grid md:grid-cols-2 gap-8 w-full max-w-4xl">
            
            <!-- 学生入口 (保持不变) -->
            <a href="student.html" class="group relative block transform hover:-translate-y-1 transition-all duration-300">
                <div class="glass-card rounded-3xl p-8 h-full shadow-lg hover:shadow-2xl hover:bg-white transition-all border-l-4 border-blue-500 flex flex-col items-start">
                    <div class="w-14 h-14 bg-blue-100 rounded-2xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform">
                        <i class="fa-solid fa-graduation-cap text-2xl text-blue-600"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-slate-800 mb-2">我是学生 (Participant)</h2>
                    <p class="text-slate-500 mb-6 text-sm">参与在线测评。系统将记录您的答题轨迹。</p>
                    <span class="mt-auto inline-flex items-center text-blue-600 font-bold text-sm uppercase tracking-wide group-hover:underline">
                        开始实验 <i class="fa-solid fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                    </span>
                </div>
            </a>

            <!-- 管理员入口 (修改为点击触发弹窗) -->
            <div id="researcher-btn" class="cursor-pointer group relative block transform hover:-translate-y-1 transition-all duration-300">
                <div class="glass-card rounded-3xl p-8 h-full shadow-lg hover:shadow-2xl hover:bg-white transition-all border-l-4 border-slate-500 flex flex-col items-start">
                    <div class="w-14 h-14 bg-slate-100 rounded-2xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform">
                        <i class="fa-solid fa-chart-line text-2xl text-slate-600"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-slate-800 mb-2">我是研究者 (Researcher)</h2>
                    <p class="text-slate-500 mb-6 text-sm">题库管理与数据导出 (CSV/Excel)。需要登录。</p>
                    <span class="mt-auto inline-flex items-center text-slate-600 font-bold text-sm uppercase tracking-wide group-hover:underline">
                        进入后台 <i class="fa-solid fa-lock ml-2 group-hover:translate-x-1 transition-transform"></i>
                    </span>
                </div>
            </div>

        </div>

        <div class="mt-16 text-slate-400 text-xs">
            &copy; 2025 Hesitation Research Project.
        </div>
    </div>

    <!-- 登录 弹窗 Modal (已移除注册切换) -->
    <div id="auth-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center">
        <!-- 背景遮罩 -->
        <div id="modal-backdrop" class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity opacity-0"></div>
        
        <!-- 弹窗内容 -->
        <div id="modal-content" class="relative bg-white w-full max-w-md mx-4 rounded-3xl shadow-2xl overflow-hidden transform transition-all scale-95 opacity-0">
            <!-- 顶部装饰条 -->
            <div class="h-2 bg-gradient-to-r from-blue-500 to-indigo-600"></div>
            
            <!-- 关闭按钮 -->
            <button id="close-modal" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 transition-colors">
                <i class="fa-solid fa-xmark text-xl"></i>
            </button>

            <div class="p-8">
                <div class="text-center mb-8">
                    <div class="w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fa-solid fa-user-shield text-indigo-600 text-xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-slate-800">研究者登录</h3>
                    <p class="text-slate-500 text-sm mt-1">请输入您的凭证以访问管理后台</p>
                </div>

                <!-- 错误信息提示区 -->
                <div id="error-message" class="hidden mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-600 text-xs flex items-center">
                    <i class="fa-solid fa-circle-exclamation mr-2"></i>
                    <span id="error-text">发生错误</span>
                </div>

                <form id="auth-form" class="space-y-4">
                    <div>
                        <label for="email" class="block text-sm font-medium text-slate-700 mb-1">电子邮箱</label>
                        <div class="relative">
                            <i class="fa-solid fa-envelope absolute left-3 top-3 text-slate-400 text-sm"></i>
                            <input type="email" id="email" required 
                                class="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all"
                                placeholder="name@research.edu">
                        </div>
                    </div>
                    
                    <div>
                        <label for="password" class="block text-sm font-medium text-slate-700 mb-1">密码</label>
                        <div class="relative">
                            <i class="fa-solid fa-lock absolute left-3 top-3 text-slate-400 text-sm"></i>
                            <input type="password" id="password" required 
                                class="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all"
                                placeholder="••••••••">
                        </div>
                    </div>

                    <button type="submit" id="submit-btn" class="w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-3 rounded-xl shadow-lg transform active:scale-95 transition-all flex items-center justify-center">
                        <span>登录后台</span>
                        <i class="fa-solid fa-arrow-right ml-2 text-xs"></i>
                    </button>
                </form>

                <!-- 已移除注册切换链接 -->
                <div class="mt-6 text-center text-xs text-slate-400">
                    如需注册账号，请联系系统管理员。
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // 导入 Firebase 模块 (移除了 createUserWithEmailAndPassword)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // --- Firebase 配置 ---
        const firebaseConfig = {
            apiKey: "AIzaSyCsc75cgtVOCBI_GjVh-l8RsrhOcCIkNqw",
            authDomain: "hesitation-research.firebaseapp.com",
            projectId: "hesitation-research",
            storageBucket: "hesitation-research.firebasestorage.app",
            messagingSenderId: "633469376688",
            appId: "1:633469376688:web:dc26878c070a05a35b4375",
            measurementId: "G-ZNZ14Q5R98"
        };
        
        // 初始化 Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // --- DOM 元素 ---
        const researcherBtn = document.getElementById('researcher-btn');
        const authModal = document.getElementById('auth-modal');
        const modalBackdrop = document.getElementById('modal-backdrop');
        const modalContent = document.getElementById('modal-content');
        const closeModalBtn = document.getElementById('close-modal');
        const authForm = document.getElementById('auth-form');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const submitBtn = document.getElementById('submit-btn');
        const errorMsgDiv = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');

        // --- 事件监听 ---

        // 打开弹窗
        researcherBtn.addEventListener('click', () => {
            authModal.classList.remove('hidden');
            // 小延迟触发动画
            setTimeout(() => {
                modalBackdrop.classList.remove('opacity-0');
                modalContent.classList.remove('scale-95', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
            emailInput.focus();
        });

        // 关闭弹窗函数
        function closeModal() {
            modalBackdrop.classList.add('opacity-0');
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-95', 'opacity-0');
            
            // 等待动画结束再隐藏 DOM
            setTimeout(() => {
                authModal.classList.add('hidden');
                resetForm();
            }, 300);
        }

        closeModalBtn.addEventListener('click', closeModal);
        modalBackdrop.addEventListener('click', closeModal);

        // 提交表单 (仅登录逻辑)
        authForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = emailInput.value;
            const password = passwordInput.value;

            // 显示加载状态
            setLoading(true);
            hideError();

            try {
                // --- 登录逻辑 ---
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                console.log("登录成功:", userCredential.user);
                
                // 尝试跳转
                redirectToAdmin();

            } catch (error) {
                console.error("认证错误:", error);
                showError(parseFirebaseError(error.code));
                setLoading(false);
            }
        });

        // --- 安全跳转函数 ---
        function redirectToAdmin() {
            const targetUrl = 'admin.html';
            try {
                window.location.href = targetUrl;
            } catch (e) {
                console.warn("预览环境跳转被拦截:", e);
                // 预览环境反馈
                submitBtn.innerHTML = '<i class="fa-solid fa-check mr-2"></i> 验证成功';
                submitBtn.classList.remove('bg-slate-800', 'hover:bg-slate-900');
                submitBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                
                setTimeout(() => {
                    alert(`登录成功！\n\n注意：在当前代码预览器中，无法实际跳转到 "${targetUrl}"。\n\n部署后将正常跳转。`);
                    closeModal();
                }, 500);
            }
        }

        // --- 辅助函数 ---

        function resetForm() {
            authForm.reset();
            hideError();
            setLoading(false);
        }

        function setLoading(isLoading) {
            if (isLoading) {
                submitBtn.disabled = true;
                submitBtn.classList.add('opacity-70', 'cursor-not-allowed');
                submitBtn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i>';
            } else {
                submitBtn.disabled = false;
                submitBtn.classList.remove('opacity-70', 'cursor-not-allowed');
                submitBtn.innerHTML = '<span>登录后台</span><i class="fa-solid fa-arrow-right ml-2 text-xs"></i>';
            }
        }

        function showError(msg) {
            errorText.textContent = msg;
            errorMsgDiv.classList.remove('hidden');
        }

        function hideError() {
            errorMsgDiv.classList.add('hidden');
        }

        // 解析 Firebase 错误代码为中文提示
        function parseFirebaseError(code) {
            switch (code) {
                case 'auth/invalid-email': return '邮箱格式不正确。';
                case 'auth/user-disabled': return '该用户已被禁用。';
                case 'auth/user-not-found': return '找不到该邮箱对应的用户。';
                case 'auth/wrong-password': return '密码错误，请重试。';
                case 'auth/invalid-credential': return '邮箱或密码错误，请重试。'; // 较新版 Firebase 可能使用此 code
                default: return '登录失败，请检查账号密码 (' + code + ')。';
            }
        }
    </script>
</body>
</html>
